services:
  database:
    build:
      image: postgres
      restart: always
      env_file: Database/database.env
      healthcheck:
        test: ["CMD-SHELL", "sh -c 'pg_isready -U ${POSTGRES_USER} -d ${POSTGRES_DB}'"]
        interval: 10s
        timeout: 3s
        retries: 3
      ports:
        - "5432:5432"
  server:
    build: 
      context: .
      dockerfile: PetroServer/Dockerfile
    networks:
      - petro-network
    healthcheck:
      test: ["CMD-SHELL", "curl --fail http://localhost:5170/health || exit 1"]
      interval: 30s
      timeout: 30s
      retries: 3
    depends_on:
      database:
        condition: service_healthy

networks:
  petro-network:
    driver: bridge